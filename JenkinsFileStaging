#!groovyâ€‹

pipeline {
    agent any
    stages {
        stage 'Checkout' {
            steps {
                git url: 'https://github.com/NetHome/NetHomeServer.git'
            }
        }

        stage 'Build' {
            steps {
                withEnv(["JAVA_HOME=${tool 'Java8'}", "PATH+MAVEN=${tool 'Maven3'}/bin:${env.JAVA_HOME}/bin"]) {
                    sh "mvn --batch-mode -V -U -e clean install -Dsurefire.useFile=false"
                }
            }
        }

        stage 'Deploy' {
            steps {
                withCredentials([usernameColonPassword(credentialsId: 'nethomeftp', variable: 'NETHOMEFTP')]) {
                    sh '''
                       set +x
                       cp server-install/target/nethomeservernightly.zip server-install/target/nethomeserverstaging.zip
                       curl -T server-install/target/nethomeserverstaging.zip ftp://ftpcluster.loopia.se/wiki.nethome.nu/public_html/data/media/ --user $NETHOMEFTP
                       '''
                }
            }
        }
    }
}
